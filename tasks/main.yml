# file: tasks/main.yml
---
- name: Gathering facts
  ansible.builtin.setup:
    gather_subset: min

- name: Installing Ubuntu/Debian dependencies
  ansible.builtin.apt:
    name:
      - automake
      - bison
      - gcc
      - git
      - libevent-dev
      - libncurses5-dev
      - make
      - pkg-config
    state: present
  when: ansible_pkg_mgr == 'apt'

- name: Installing Fedora/EL dependencies
  ansible.builtin.yum:
    name:
      - automake
      - byacc
      - gcc
      - git
      - libevent-devel
      - ncurses-devel
      - xclip
      - xsel
    state: installed
  when: ansible_pkg_mgr == 'yum' or ansible_pkg_mgr == 'dnf'

- name: Git cloning tmux source
  ansible.builtin.git:
    repo: https://github.com/tmux/tmux.git
    dest: /usr/src/tmux
    version: 3.3a

- name: Running autogen.sh
  ansible.builtin.command: /bin/sh autogen.sh
  args:
    chdir: /usr/src/tmux
    creates: /usr/src/tmux/configure

- name: Running ./configure
  ansible.builtin.command: ./configure
  args:
    chdir: /usr/src/tmux
    creates: Makefile

- name: Running make
  community.general.make:
    chdir: /usr/src/tmux
    params:
      NUMTHREADS: 4

- name: Installing via make install
  community.general.make:
    chdir: /usr/src/tmux
    target: install

- name: Adding /usr/local/bin to PATH via /etc/profile.d/tmux.sh
  ansible.builtin.copy:
    src: tmux.sh
    dest: /etc/profile.d/tmux.sh
    mode: 0644
  when: ansible_os_family == 'RedHat'

- name: Cleaning up
  ansible.builtin.file:
    path: /usr/src/tmux
    state: absent
...
